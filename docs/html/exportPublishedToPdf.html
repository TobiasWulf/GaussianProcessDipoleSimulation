
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: {extensions: ["mhchem.js"]},
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true
            },
            CommonHTML: {minScaleAdjust: 110,},
            "HTML-CSS": {
                availableFonts: ["TeX"],
                scale: 110
            }
        });
        MathJax.Hub.Queue(["Rerender", MathJax.Hub], function () {window.status="finished"});
    </script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>exportPublishedToPdf</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-02-17"><meta name="DC.source" content="exportPublishedToPdf.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>exportPublishedToPdf</h1><!--introduction--><p>Export Matlab generated HTML documentation (publish) to pdf-files and combine them into a LaTeX index file ready compile to pdf manual. This script works on unix sytems only or needs to be adjusted for windows systems for library path and wkhtmltopdf binary path.</p><p><b>Runs on Unix systems only!</b></p><!--/introduction--><h2 id="1">Requirements</h2><div><ul><li>Other m-files required: src/util/removeFilesFromDir.m</li><li>Subfunctions: wkhtmltopdf (shell), pdflatex (shell)</li><li>MAT-files required: data/config.mat</li></ul></div><h2 id="2">See Also</h2><div><ul><li><a href="generateConfigMat.html">generateConfigMat</a></li><li><a href="matlab:web(fullfile(docroot,'matlab/ref/system.html'))">system</a></li><li><a href="https://wkhtmltopdf.org/">wkhtmltopdf</a></li><li><a href="publishProjectFilesToHTML.html">publishProjectFilesToHTML</a></li><li><a href="Documentation_Workflow.html">Documentation Workflow</a></li></ul></div><p>Created on December 10. 2020 by Tobias Wulf. Copyright Tobias Wulf 2020.</p><p>
<!--
Hidden Clutter.
Edited on Month DD. YYYY by Editor: Single line description.
-->
</p><h2 id="3">Start Exporting Script, Clean Up and Load Config</h2><p>At first clean up junk from workspace and clear prompt for new output. Set project root path to create absolute file path with fullfile function. Load absolute path variables and publishing options from config.mat</p><pre class="codeinput">disp(<span class="string">'Workspace cleaned up ...'</span>);
clearvars;
clc;
disp(<span class="string">'Load configuration ...'</span>);
<span class="keyword">try</span>
    load(<span class="string">'config.mat'</span>, <span class="string">'PathVariables'</span>);
<span class="keyword">catch</span> ME
    rethrow(ME);
<span class="keyword">end</span>
</pre><h2 id="4">Define Manual TOC</h2><p>The maual toc must be in the same order as in helptoc.xml in the publish html folder. The toc is used to generate a latex file to include for appendices.</p><pre class="codeinput">toc = [<span class="string">"section"</span>,           <span class="string">"GaussianProcessDipoleSimulation.pdf"</span>;
       <span class="string">"section"</span>            <span class="string">"Workflows.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"Project_Preparation.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"Project_Structure.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"Git_Feature_Branch_Workflow.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"Documentation_Workflow.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"Simulation_Workflow.pdf"</span>;
       <span class="string">"section"</span>,           <span class="string">"Executable_Scripts.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"publishProjectFilesToHTML.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"generateConfigMat.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"generateSimulationDatasets.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"deleteSimulationDatasets.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"deleteSimulationPlots.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"exportPublishedToPdf"</span>;
       <span class="string">"section"</span>,           <span class="string">"Source_Code.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"sensorArraySimulation.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"rotate3DVector.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"generateDipoleRotationMoments.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"generateSensorArraySquareGrid.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"computeDipoleH0Norm.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"computeDipoleHField.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"simulateDipoleSquareSensorArray.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"gaussianProcessRegression.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"basicMathFunctions.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"sinoids2angles.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"angles2sinoids.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"decomposeChol.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"frobeniusNorm.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"computeInverseMatrixProduct.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"computeTransposeInverseProduct.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"paragraph"</span>,         <span class="string">""</span>;
       <span class="string">"subsection"</span>,        <span class="string">"util.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"removeFilesFromDir.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"publishFilesFromDir.pdf"</span>;
       <span class="string">"subsubsection"</span>,     <span class="string">"plotFunctions.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotTDKCharDataset.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotTDKCharField.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotTDKTransferCurves.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotKMZ60CharDataset.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotKMZ60CharField.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotKMZ60TransferCurves.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotDipoleMagnet.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotSimulationDataset.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotSingleSimulationAngle.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotSimulationSubset.pdf"</span>;
       <span class="string">"paragraph"</span>,         <span class="string">"plotSimulationCosSinStats.pdf"</span>
       <span class="string">"paragraph"</span>,         <span class="string">"plotSimulationDatasetCircle.pdf"</span>;
       <span class="string">"section"</span>,           <span class="string">"Datasets.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"TDK_TAS2141_Characterization.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"NXP_KMZ60_Characterization.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"Config_Mat.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"Training_and_Test_Datasets.pdf"</span>;
       <span class="string">"section"</span>,           <span class="string">"Unit_Tests.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"runTests.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"removeFilesFromDirTest.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"rotate3DVectorTest.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"generateDipoleRotationMomentsTest.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"generateSensorArraySquareGridTest.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"computeDipoleH0NormTest.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"computeDipoleHFieldTest.pdf"</span>;
       <span class="string">"subsection"</span>,        <span class="string">"tiltRotationTest.pdf"</span>;];

nToc = length(toc);
fprintf(<span class="string">"%d toc entries remarked ...\n"</span>, nToc);
</pre><h2 id="5">Scan for HTML Files</h2><p>Scan for all published HTML files in the project publish directory.</p><pre class="codeinput">disp(<span class="string">'Scan for published files ...'</span>);
HTML = dir(fullfile(PathVariables.publishHtmlPath, <span class="string">'*.html'</span>));
<span class="keyword">if</span> nToc ~= length(HTML)
    warning(<span class="keyword">...</span>
        <span class="string">'TOC (%d) length and found HTML (%d) files are diverging.'</span>, <span class="keyword">...</span>
        nToc, length(HTML));
<span class="keyword">end</span>
</pre><h2 id="6">Export HTML to Pdf</h2><p>Export found HTML files to Pdf files. Each file gets its own Pdf represenstation. Filename is kept with pdf extension. Write files into Manual folder under LaTeX subdirectory in docs path. Using wkhtmltopdf shell application. Get filename, add pdf extension new path to file. Create shell string to execute with system command. Get current library path (Matlab) and change it to system library path to execute wkhtmltopdf after that restor library back to Matlab.</p><pre class="codeinput">disp(<span class="string">'Change local library path to system path ...'</span>);
matlabLibPath = getenv(<span class="string">'LD_LIBRARY_PATH'</span>);
systemLibPath = <span class="string">'/usr/lib/x86_64-linux-gnu'</span>;
setenv(<span class="string">'LD_LIBRARY_PATH'</span>, systemLibPath);

disp(<span class="string">'Export published HTML to Pdf ...'</span>);
fprintf(<span class="string">'Source: %s\n'</span>, HTML(1).folder);
fprintf(<span class="string">'Destination: %s\n'</span>, PathVariables.exportPublishPath);
<span class="keyword">for</span> fhtml = HTML'
    disp(fhtml.name);
    [~, fName, ~] = fileparts(fhtml.name);
    sourcePath = fullfile(fhtml.folder, fhtml.name);
    destinationPath = fullfile(<span class="keyword">...</span>
        PathVariables.exportPublishPath, [fName <span class="string">'.pdf'</span>]);

    cmdStr = join([<span class="string">"wkhtmltopdf"</span>, <span class="keyword">...</span>
        <span class="string">"-B 47mm"</span>, <span class="keyword">...</span>
        <span class="string">"-L 27mm"</span>, <span class="keyword">...</span>
        <span class="string">"-R 27mm"</span>, <span class="keyword">...</span>
        <span class="string">"-T 37mm"</span>, <span class="keyword">...</span>
        <span class="string">"--minimum-font-size 12"</span>, <span class="keyword">...</span>
        <span class="string">"--enable-local-file-access"</span>, <span class="keyword">...</span>
        <span class="string">"--disable-external-links"</span>, <span class="keyword">...</span>
        <span class="string">"--disable-internal-links"</span>, <span class="keyword">...</span>
        <span class="keyword">...</span><span class="comment"> "--disable-smart-shrinking", ...</span>
        <span class="string">"--window-status finished"</span>, <span class="keyword">...</span>
        <span class="string">"--no-stop-slow-scripts"</span>, <span class="keyword">...</span>
        <span class="string">"--javascript-delay 2000"</span>, <span class="keyword">...</span>
        <span class="string">"%s %s"</span>]);
    shellStr = sprintf(cmdStr, sourcePath, destinationPath);

    <span class="keyword">try</span>
        [status, cmdout] = system(shellStr);
        <span class="comment">% disp(cmdout);</span>
        <span class="keyword">if</span> status ~= 0
            error(<span class="string">'Export failure.'</span>);
        <span class="keyword">end</span>
    <span class="keyword">catch</span> ME
        setenv(<span class="string">'LD_LIBRARY_PATH'</span>, matlabLibPath);
        disp(cmdout);
        rethrow(ME)
    <span class="keyword">end</span>
<span class="keyword">end</span>

disp(<span class="string">'Restore local library path ...'</span>);
setenv(<span class="string">'LD_LIBRARY_PATH'</span>, matlabLibPath);
</pre><h2 id="7">Write TOC to LaTeX File</h2><p>Wirete TOC to LaTeX file and generate for each pdf to include a toc content line with marked toc depth. Get the number of pages and add only page title first pdf page.</p><pre class="codeinput">disp(<span class="string">'Write TOC to Manual.tex ...'</span>);
addFirstPage = <span class="string">"\\addtocounter{%s}{1}\n"</span> + <span class="keyword">...</span>
    <span class="string">"\\includepdf[page=1,"</span> + <span class="keyword">...</span>
    <span class="string">"pagecommand={\\phantomsection\\"</span> + <span class="keyword">...</span>
    <span class="string">"addcontentsline{toc}{%s}"</span> + <span class="keyword">...</span>
    <span class="string">"{\\protect\\numberline{\\the%s}%s}\\label{%s}}]{%s}\n"</span>;
addRestPages = <span class="string">"\\includepdf[page=2-, pagecommand={\\phantomsection}]{%s}\n"</span>;

fileID = fopen(fullfile(<span class="keyword">...</span>
    PathVariables.exportPublishPath, <span class="string">'Manual.tex'</span>), <span class="string">'w'</span>);
<span class="comment">% fprintf(fileID, "%% !TEX root = ../thesis.tex\n");</span>
fprintf(fileID, <span class="string">"%% appendix software documentation\n"</span>);
fprintf(fileID, <span class="string">"%% @author Tobias Wulf\n"</span>);
fprintf(fileID, <span class="keyword">...</span>
    <span class="string">"%% Autogenerated LaTeX file. Generated by exportPublishedToPdf.\n"</span>);
fprintf(fileID, <span class="keyword">...</span>
    <span class="string">"%% Software manual with TOC generated in the same script.\n"</span>);
fprintf(fileID, <span class="string">"%% Generated on %s.\n\n"</span>, datestr(datetime(<span class="string">'now'</span>)));

pat = regexpPattern(<span class="string">"\d+"</span>);
shellStr = <span class="string">"pdfinfo %s | grep Pages"</span>;

<span class="keyword">for</span> i = 1:nToc
    level = toc(i);
    fName = toc(i,2);
    [~, titleStr, ~] = fileparts(fName);
    titleStr = strrep(titleStr, <span class="string">'_'</span>, <span class="string">' '</span>);
    <span class="keyword">try</span>
        [status, cmdout] = system(sprintf(shellStr, <span class="keyword">...</span>
            fullfile(PathVariables.exportPublishPath, fName)));
        pages = double(extract(string(cmdout), pat));

        fprintf(fileID, addFirstPage, level, level, level, <span class="keyword">...</span>
            titleStr, titleStr, fName);
        <span class="keyword">if</span> pages &gt; 1, fprintf(fileID, addRestPages, fName); <span class="keyword">end</span>

    <span class="keyword">catch</span> ME
        setenv(<span class="string">'LD_LIBRARY_PATH'</span>, matlabLibPath);
        fclose(fileID);
        disp(cmdout);
        rethrow(ME)
    <span class="keyword">end</span>
<span class="keyword">end</span>
fclose(fileID);
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% exportPublishedToPdf
% Export Matlab generated HTML documentation (publish) to pdf-files and combine
% them into a LaTeX index file ready compile to pdf manual. This script works on
% unix sytems only or needs to be adjusted for windows systems for library path
% and wkhtmltopdf binary path.
%
% *Runs on Unix systems only!*
%
%
%% Requirements
% * Other m-files required: src/util/removeFilesFromDir.m
% * Subfunctions: wkhtmltopdf (shell), pdflatex (shell)
% * MAT-files required: data/config.mat
%
%
%% See Also
% * <generateConfigMat.html generateConfigMat>
% * <matlab:web(fullfile(docroot,'matlab/ref/system.html')) system>
% * <https://wkhtmltopdf.org/ wkhtmltopdf>
% * <publishProjectFilesToHTML.html publishProjectFilesToHTML>
% * <Documentation_Workflow.html Documentation Workflow>
%
%
% Created on December 10. 2020 by Tobias Wulf. Copyright Tobias Wulf 2020.
%
% <html>
% <!REPLACE_WITH_DASH_DASH
% Hidden Clutter.
% Edited on Month DD. YYYY by Editor: Single line description.
% REPLACE_WITH_DASH_DASH>
% </html>
%
%
%% Start Exporting Script, Clean Up and Load Config
% At first clean up junk from workspace and clear prompt for new output. Set
% project root path to create absolute file path with fullfile function.
% Load absolute path variables and publishing options from config.mat
disp('Workspace cleaned up ...');
clearvars;
clc;
disp('Load configuration ...');
try
    load('config.mat', 'PathVariables');
catch ME
    rethrow(ME);
end

%% Define Manual TOC
% The maual toc must be in the same order as in helptoc.xml in the publish html
% folder. The toc is used to generate a latex file to include for appendices.
toc = ["section",           "GaussianProcessDipoleSimulation.pdf";
       "section"            "Workflows.pdf";
       "subsection",        "Project_Preparation.pdf";
       "subsection",        "Project_Structure.pdf";
       "subsection",        "Git_Feature_Branch_Workflow.pdf";
       "subsection",        "Documentation_Workflow.pdf";
       "subsection",        "Simulation_Workflow.pdf";
       "section",           "Executable_Scripts.pdf";
       "subsection",        "publishProjectFilesToHTML.pdf";
       "subsection",        "generateConfigMat.pdf";
       "subsection",        "generateSimulationDatasets.pdf";
       "subsection",        "deleteSimulationDatasets.pdf";
       "subsection",        "deleteSimulationPlots.pdf";
       "subsection",        "exportPublishedToPdf";
       "section",           "Source_Code.pdf";
       "subsection",        "sensorArraySimulation.pdf";
       "subsubsection",     "rotate3DVector.pdf";
       "subsubsection",     "generateDipoleRotationMoments.pdf";
       "subsubsection",     "generateSensorArraySquareGrid.pdf";
       "subsubsection",     "computeDipoleH0Norm.pdf";
       "subsubsection",     "computeDipoleHField.pdf";
       "subsubsection",     "simulateDipoleSquareSensorArray.pdf";
       "subsection",        "gaussianProcessRegression.pdf";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "subsubsection",     "";
       "paragraph",         "";
       "paragraph",         "";
       "paragraph",         "";
       "subsubsection",     "";
       "paragraph",         "";
       "paragraph",         "";
       "paragraph",         "";
       "subsubsection",     "basicMathFunctions.pdf";
       "paragraph",         "sinoids2angles.pdf";
       "paragraph",         "angles2sinoids.pdf";
       "paragraph",         "decomposeChol.pdf";
       "paragraph",         "frobeniusNorm.pdf";
       "paragraph",         "computeInverseMatrixProduct.pdf";
       "paragraph",         "computeTransposeInverseProduct.pdf";
       "paragraph",         "";
       "paragraph",         "";
       "paragraph",         "";
       "paragraph",         "";
       "paragraph",         "";
       "subsection",        "util.pdf";
       "subsubsection",     "removeFilesFromDir.pdf";
       "subsubsection",     "publishFilesFromDir.pdf";
       "subsubsection",     "plotFunctions.pdf";
       "paragraph",         "plotTDKCharDataset.pdf";
       "paragraph",         "plotTDKCharField.pdf";
       "paragraph",         "plotTDKTransferCurves.pdf";
       "paragraph",         "plotKMZ60CharDataset.pdf";
       "paragraph",         "plotKMZ60CharField.pdf";
       "paragraph",         "plotKMZ60TransferCurves.pdf";
       "paragraph",         "plotDipoleMagnet.pdf";
       "paragraph",         "plotSimulationDataset.pdf";
       "paragraph",         "plotSingleSimulationAngle.pdf";
       "paragraph",         "plotSimulationSubset.pdf";
       "paragraph",         "plotSimulationCosSinStats.pdf"
       "paragraph",         "plotSimulationDatasetCircle.pdf";
       "section",           "Datasets.pdf";
       "subsection",        "TDK_TAS2141_Characterization.pdf";
       "subsection",        "NXP_KMZ60_Characterization.pdf";
       "subsection",        "Config_Mat.pdf";
       "subsection",        "Training_and_Test_Datasets.pdf";
       "section",           "Unit_Tests.pdf";
       "subsection",        "runTests.pdf";
       "subsection",        "removeFilesFromDirTest.pdf";
       "subsection",        "rotate3DVectorTest.pdf";
       "subsection",        "generateDipoleRotationMomentsTest.pdf";
       "subsection",        "generateSensorArraySquareGridTest.pdf";
       "subsection",        "computeDipoleH0NormTest.pdf";
       "subsection",        "computeDipoleHFieldTest.pdf";
       "subsection",        "tiltRotationTest.pdf";];

nToc = length(toc);
fprintf("%d toc entries remarked ...\n", nToc);


%% Scan for HTML Files
% Scan for all published HTML files in the project publish directory.
disp('Scan for published files ...');
HTML = dir(fullfile(PathVariables.publishHtmlPath, '*.html'));
if nToc ~= length(HTML)
    warning(...
        'TOC (%d) length and found HTML (%d) files are diverging.', ...
        nToc, length(HTML));
end

%% Export HTML to Pdf
% Export found HTML files to Pdf files. Each file gets its own Pdf
% represenstation. Filename is kept with pdf extension. Write files into Manual
% folder under LaTeX subdirectory in docs path. Using wkhtmltopdf shell
% application. Get filename, add pdf extension new path to file. Create shell
% string to execute with system command. Get current library path (Matlab) and
% change it to system library path to execute wkhtmltopdf after that restor
% library back to Matlab.
disp('Change local library path to system path ...');
matlabLibPath = getenv('LD_LIBRARY_PATH');
systemLibPath = '/usr/lib/x86_64-linux-gnu';
setenv('LD_LIBRARY_PATH', systemLibPath);

disp('Export published HTML to Pdf ...');
fprintf('Source: %s\n', HTML(1).folder);
fprintf('Destination: %s\n', PathVariables.exportPublishPath);
for fhtml = HTML'
    disp(fhtml.name);
    [~, fName, ~] = fileparts(fhtml.name);
    sourcePath = fullfile(fhtml.folder, fhtml.name);
    destinationPath = fullfile(...
        PathVariables.exportPublishPath, [fName '.pdf']);
    
    cmdStr = join(["wkhtmltopdf", ...
        "-B 47mm", ...
        "-L 27mm", ...
        "-R 27mm", ...
        "-T 37mm", ...
        "REPLACE_WITH_DASH_DASHminimum-font-size 12", ...
        "REPLACE_WITH_DASH_DASHenable-local-file-access", ...
        "REPLACE_WITH_DASH_DASHdisable-external-links", ...
        "REPLACE_WITH_DASH_DASHdisable-internal-links", ...
        ... "REPLACE_WITH_DASH_DASHdisable-smart-shrinking", ...
        "REPLACE_WITH_DASH_DASHwindow-status finished", ...
        "REPLACE_WITH_DASH_DASHno-stop-slow-scripts", ...
        "REPLACE_WITH_DASH_DASHjavascript-delay 2000", ...
        "%s %s"]);
    shellStr = sprintf(cmdStr, sourcePath, destinationPath);
    
    try
        [status, cmdout] = system(shellStr);
        % disp(cmdout);
        if status ~= 0
            error('Export failure.');
        end
    catch ME
        setenv('LD_LIBRARY_PATH', matlabLibPath);
        disp(cmdout);
        rethrow(ME)
    end
end

disp('Restore local library path ...');
setenv('LD_LIBRARY_PATH', matlabLibPath);


%% Write TOC to LaTeX File
% Wirete TOC to LaTeX file and generate for each pdf to include a toc content
% line with marked toc depth. Get the number of pages and add only page title
% first pdf page.
disp('Write TOC to Manual.tex ...');
addFirstPage = "\\addtocounter{%s}{1}\n" + ...
    "\\includepdf[page=1," + ...
    "pagecommand={\\phantomsection\\" + ...
    "addcontentsline{toc}{%s}" + ...
    "{\\protect\\numberline{\\the%s}%s}\\label{%s}}]{%s}\n";
addRestPages = "\\includepdf[page=2-, pagecommand={\\phantomsection}]{%s}\n";

fileID = fopen(fullfile(...
    PathVariables.exportPublishPath, 'Manual.tex'), 'w');
% fprintf(fileID, "%% !TEX root = ../thesis.tex\n");
fprintf(fileID, "%% appendix software documentation\n");
fprintf(fileID, "%% @author Tobias Wulf\n");
fprintf(fileID, ...
    "%% Autogenerated LaTeX file. Generated by exportPublishedToPdf.\n");
fprintf(fileID, ...
    "%% Software manual with TOC generated in the same script.\n");
fprintf(fileID, "%% Generated on %s.\n\n", datestr(datetime('now')));

pat = regexpPattern("\d+");
shellStr = "pdfinfo %s | grep Pages";

for i = 1:nToc
    level = toc(i);
    fName = toc(i,2);
    [~, titleStr, ~] = fileparts(fName);
    titleStr = strrep(titleStr, '_', ' ');
    try
        [status, cmdout] = system(sprintf(shellStr, ...
            fullfile(PathVariables.exportPublishPath, fName)));
        pages = double(extract(string(cmdout), pat));
        
        fprintf(fileID, addFirstPage, level, level, level, ...
            titleStr, titleStr, fName);
        if pages > 1, fprintf(fileID, addRestPages, fName); end
        
    catch ME
        setenv('LD_LIBRARY_PATH', matlabLibPath);
        fclose(fileID);
        disp(cmdout);
        rethrow(ME)
    end   
end
fclose(fileID);

##### SOURCE END #####
--></body></html>
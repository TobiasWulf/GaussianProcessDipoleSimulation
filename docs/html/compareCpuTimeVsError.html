
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: {extensions: ["mhchem.js"]},
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true
            },
            CommonHTML: {minScaleAdjust: 110,},
            "HTML-CSS": {
                availableFonts: ["TeX"],
                scale: 110
            }
        });
        MathJax.Hub.Queue(["Rerender", MathJax.Hub], function () {window.status="finished"});
    </script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>compareCpuTimeVsError</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-05-13"><meta name="DC.source" content="compareCpuTimeVsError.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>compareCpuTimeVsError</h1><!--introduction--><p>This scripts compares relative computing time of a single test point versus max and mean angle erros of a completet rotation to generate a metric which estimates a good relation between speed and angle error acceptance. Therefor several training datasets with different number of reference angles must be generated. The training datasets must correspond to test datasets which must correlate in position and tilt. The script runs without noise optimization. Set the noise level to noise upper bounds in config script to have widest complexity ranges. The script values the inner fmincon kernel optimization.</p><!--/introduction--><h2 id="1">Requirements</h2><div><ul><li>Other m-files required: gaussianProcessRegression module files</li><li>Subfunctions: none</li><li>MAT-files required: data/config.mat, corresponding Training and Test dataset</li></ul></div><h2 id="2">See Also</h2><div><ul><li><a href="gaussianProcessRegression.html">gaussianProcessRegression</a></li><li><a href="initGPR.html">initGPR</a></li><li><a href="tuneGPR.html">tuneGPR</a></li><li><a href="generateConfigMat.html">generateConfigMat</a></li></ul></div><p>Created on May 01. 2021 by Tobias Wulf. Copyright Tobias Wulf 2021.</p><p>
<!--
Hidden Clutter.
Edited on Month DD. YYYY by Editor: Single line description.
-->
</p><h2 id="3">Start Script, Load Config and Read in Datasets</h2><pre class="codeinput">clc;
disp(<span class="string">'Start compare cpu time vs. error ...'</span>);
clearvars;
close <span class="string">all</span>;

disp(<span class="string">'Load config ...'</span>);
load <span class="string">config.mat</span> <span class="string">PathVariables</span> <span class="string">GPROptions</span>;

disp(<span class="string">'Search for datasets ...'</span>);
TrainFiles = dir(fullfile(PathVariables.trainingDataPath, <span class="string">'Training*.mat'</span>));
TestFiles = dir(fullfile(PathVariables.testDataPath, <span class="string">'Test*.mat'</span>));
assert(~isempty(TrainFiles), <span class="string">'No training datasets found.'</span>);
assert(~isempty(TestFiles), <span class="string">'No test datasets found.'</span>);
assert(length(TrainFiles) == length(TestFiles), <span class="string">'Not equal number of datasets.'</span>);

nDatasets = length(TrainFiles);
tang = 73;
</pre><h2 id="4">Load Datasets in a Loop and Measure Model Errors and Computation Time</h2><pre class="codeinput">cTime = zeros(nDatasets, 2);
mError = zeros(nDatasets, 2);
xError = zeros(nDatasets, 2);
nAngles =zeros(nDatasets, 1);
<span class="keyword">for</span> i = 1:nDatasets
    fprintf(<span class="string">'Load datasets: %d'</span>, i);
    <span class="keyword">try</span>
        TrainDS = load(fullfile(TrainFiles(i).folder, TrainFiles(i).name));
        TestDS = load(fullfile(TestFiles(i).folder, TestFiles(i).name));

    <span class="keyword">catch</span> ME
        rethrow(ME)
    <span class="keyword">end</span>

    assert(TrainDS.Info.UseOptions.xPos == TestDS.Info.UseOptions.xPos);
    assert(TrainDS.Info.UseOptions.yPos == TestDS.Info.UseOptions.yPos);
    assert(TrainDS.Info.UseOptions.zPos == TestDS.Info.UseOptions.zPos);
    assert(TrainDS.Info.UseOptions.tilt == TestDS.Info.UseOptions.tilt);
    disp(<span class="string">' check corresponding: pass'</span>);

    nAngles(i) = TrainDS.Info.UseOptions.nAngles;

    fprintf(<span class="string">'Get test point: %d\n'</span>, tang);
    Xcos = TestDS.Data.Vcos(:,:,tang);
    Xsin = TestDS.Data.Vsin(:,:,tang);

    disp(<span class="string">'Init and rain models ...'</span>);
    mdl0 = initGPR(TrainDS, GPROptions);

    fprintf(<span class="string">'Zero mean, N = %d\n'</span>, mdl0.N);
    mdl0 = tuneKernel(mdl0, 1);

    GPROptions.mean = <span class="string">'poly'</span>;
    GPROptions.polyDegree = 1;
    mdl1 = initGPR(TrainDS, GPROptions);

    fprintf(<span class="string">'Poly mean, N = %d\n'</span>, mdl0.N);
    mdl1 = tuneKernel(mdl1, 1);

    disp(<span class="string">'Measure cpu time ...'</span>);
    f0 = @() predFrame(mdl0, Xcos, Xsin);
    f1 = @() predFrame(mdl1, Xcos, Xsin);

    cTime(i,1) = timeit(f0);
    cTime(i,2) = timeit(f1);

    disp(<span class="string">'Compute abs mean and max erros ...'</span>);
    absErr0 = lossDS(mdl0, TestDS);
    absErr1 = lossDS(mdl1, TestDS);
    mError(i,:) = [mean(absErr0), mean(absErr1)];
    xError(i,:) = [max(absErr0), max(absErr1)];
<span class="keyword">end</span>
</pre><h2 id="5">Plot Timings and Errors</h2><pre class="codeinput">close <span class="string">all</span>
n = 1:nDatasets;

figure(<span class="string">'Name'</span>, <span class="string">'Timing vs. Errors'</span>, <span class="keyword">...</span>
    <span class="string">'Units'</span>, <span class="string">'normalize'</span>, <span class="string">'OuterPosition'</span>, [0 0 1 1]);

tiledlayout(2, 2, <span class="string">'TileSpacing'</span>, <span class="string">'normal'</span>);

<span class="comment">% plot cpu timings</span>
nexttile([1 2]);

hold <span class="string">on</span>;
plot(n, cTime(:, 1), <span class="string">'-*'</span>);
plot(n, cTime(:, 2), <span class="string">'-*'</span>);
xlim([0 nDatasets + 1]);
xticks(n);
xticklabels(nAngles);
xlabel(<span class="string">'$N_{Ref}$'</span>);
ylabel(<span class="string">'$t$ in s'</span>);
title(<span class="string">'a) CPU Time by Single Test Angle'</span>);

<span class="comment">% plot mean errors</span>
nexttile;

hold <span class="string">on</span>;
plot(n, mError(:, 1), <span class="string">'-*'</span>);
plot(n, mError(:, 2), <span class="string">'-*'</span>);
xlim([0 nDatasets + 1]);
xticks(n);
xticklabels(nAngles);
xlabel(<span class="string">'$N_{Ref}$'</span>);
ylabel(<span class="string">'$\mu(\epsilon_{abs})$ in $^\circ$'</span>);
title(<span class="string">'b) Mean Error by 720 Test Angles'</span>);

<span class="comment">% plot max errors</span>
nexttile

hold <span class="string">on</span>;
plot(n, xError(:, 1), <span class="string">'-*'</span>);
plot(n, xError(:, 2), <span class="string">'-*'</span>);
xlim([0 nDatasets + 1]);
xticks(n);
xticklabels(nAngles);
xlabel(<span class="string">'$N_{Ref}$'</span>);
ylabel(<span class="string">'$\max\epsilon_{abs}$ in $^\circ$'</span>);
title(<span class="string">'c) Max Error by 720 Test Angles'</span>);

legend({<span class="string">'Zero Mean GPR'</span>, <span class="string">'Poly Mean GPR'</span>}, <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
    <span class="string">'Position'</span>, [.85 .48 .125 .07]);
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% compareCpuTimeVsError
% This scripts compares relative computing time of a single test point versus
% max and mean angle erros of a completet rotation to generate a metric which
% estimates a good relation between speed and angle error acceptance. Therefor
% several training datasets with different number of reference angles must be
% generated. The training datasets must correspond to test datasets which must
% correlate in position and tilt. The script runs without noise optimization.
% Set the noise level to noise upper bounds in config script to have widest
% complexity ranges. The script values the inner fmincon kernel optimization.
%
%
%% Requirements
% * Other m-files required: gaussianProcessRegression module files
% * Subfunctions: none
% * MAT-files required: data/config.mat, corresponding Training and Test dataset
%
%
%% See Also
% * <gaussianProcessRegression.html gaussianProcessRegression>
% * <initGPR.html initGPR>
% * <tuneGPR.html tuneGPR>
% * <generateConfigMat.html generateConfigMat>
%
%
% Created on May 01. 2021 by Tobias Wulf. Copyright Tobias Wulf 2021.
%
% <html>
% <!REPLACE_WITH_DASH_DASH
% Hidden Clutter.
% Edited on Month DD. YYYY by Editor: Single line description.
% REPLACE_WITH_DASH_DASH>
% </html>
%
%
%% Start Script, Load Config and Read in Datasets
clc;
disp('Start compare cpu time vs. error ...');
clearvars;
close all;

disp('Load config ...');
load config.mat PathVariables GPROptions;

disp('Search for datasets ...');
TrainFiles = dir(fullfile(PathVariables.trainingDataPath, 'Training*.mat'));
TestFiles = dir(fullfile(PathVariables.testDataPath, 'Test*.mat'));
assert(~isempty(TrainFiles), 'No training datasets found.');
assert(~isempty(TestFiles), 'No test datasets found.');
assert(length(TrainFiles) == length(TestFiles), 'Not equal number of datasets.');

nDatasets = length(TrainFiles);
tang = 73;


%% Load Datasets in a Loop and Measure Model Errors and Computation Time
cTime = zeros(nDatasets, 2);
mError = zeros(nDatasets, 2);
xError = zeros(nDatasets, 2);
nAngles =zeros(nDatasets, 1);
for i = 1:nDatasets
    fprintf('Load datasets: %d', i);
    try
        TrainDS = load(fullfile(TrainFiles(i).folder, TrainFiles(i).name));
        TestDS = load(fullfile(TestFiles(i).folder, TestFiles(i).name));

    catch ME
        rethrow(ME)
    end

    assert(TrainDS.Info.UseOptions.xPos == TestDS.Info.UseOptions.xPos);
    assert(TrainDS.Info.UseOptions.yPos == TestDS.Info.UseOptions.yPos);
    assert(TrainDS.Info.UseOptions.zPos == TestDS.Info.UseOptions.zPos);
    assert(TrainDS.Info.UseOptions.tilt == TestDS.Info.UseOptions.tilt);
    disp(' check corresponding: pass');
    
    nAngles(i) = TrainDS.Info.UseOptions.nAngles;
    
    fprintf('Get test point: %d\n', tang);
    Xcos = TestDS.Data.Vcos(:,:,tang);
    Xsin = TestDS.Data.Vsin(:,:,tang);
    
    disp('Init and rain models ...');
    mdl0 = initGPR(TrainDS, GPROptions);
    
    fprintf('Zero mean, N = %d\n', mdl0.N);
    mdl0 = tuneKernel(mdl0, 1);
    
    GPROptions.mean = 'poly';
    GPROptions.polyDegree = 1;
    mdl1 = initGPR(TrainDS, GPROptions);
    
    fprintf('Poly mean, N = %d\n', mdl0.N);
    mdl1 = tuneKernel(mdl1, 1);
    
    disp('Measure cpu time ...');
    f0 = @() predFrame(mdl0, Xcos, Xsin);
    f1 = @() predFrame(mdl1, Xcos, Xsin);
    
    cTime(i,1) = timeit(f0);
    cTime(i,2) = timeit(f1);
    
    disp('Compute abs mean and max erros ...');
    absErr0 = lossDS(mdl0, TestDS);
    absErr1 = lossDS(mdl1, TestDS);
    mError(i,:) = [mean(absErr0), mean(absErr1)];
    xError(i,:) = [max(absErr0), max(absErr1)];
end

%% Plot Timings and Errors
close all
n = 1:nDatasets;

figure('Name', 'Timing vs. Errors', ...
    'Units', 'normalize', 'OuterPosition', [0 0 1 1]);

tiledlayout(2, 2, 'TileSpacing', 'normal');

% plot cpu timings
nexttile([1 2]);

hold on;
plot(n, cTime(:, 1), '-*');
plot(n, cTime(:, 2), '-*');
xlim([0 nDatasets + 1]);
xticks(n);
xticklabels(nAngles);
xlabel('$N_{Ref}$');
ylabel('$t$ in s');
title('a) CPU Time by Single Test Angle');

% plot mean errors
nexttile;

hold on;
plot(n, mError(:, 1), '-*');
plot(n, mError(:, 2), '-*');
xlim([0 nDatasets + 1]);
xticks(n);
xticklabels(nAngles);
xlabel('$N_{Ref}$');
ylabel('$\mu(\epsilon_{abs})$ in $^\circ$');
title('b) Mean Error by 720 Test Angles');

% plot max errors
nexttile

hold on;
plot(n, xError(:, 1), '-*');
plot(n, xError(:, 2), '-*');
xlim([0 nDatasets + 1]);
xticks(n);
xticklabels(nAngles);
xlabel('$N_{Ref}$');
ylabel('$\max\epsilon_{abs}$ in $^\circ$');
title('c) Max Error by 720 Test Angles');

legend({'Zero Mean GPR', 'Poly Mean GPR'}, 'Units', 'normalized', ...
    'Position', [.85 .48 .125 .07]);


##### SOURCE END #####
--></body></html>
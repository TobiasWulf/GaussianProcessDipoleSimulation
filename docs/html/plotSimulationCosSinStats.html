
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: {extensions: ["mhchem.js"]},
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true
            },
            CommonHTML: {minScaleAdjust: 110,},
            "HTML-CSS": {
                availableFonts: ["TeX"],
                scale: 110
            }
        });
        MathJax.Hub.Queue(["Rerender", MathJax.Hub], function () {window.status="finished"});
    </script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>plotSimulationCosSinStats</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-04-14"><meta name="DC.source" content="plotSimulationCosSinStats.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>plotSimulationCosSinStats</h1><!--introduction--><p>Search for available trainings or test dataset and plot dataset. Follow user input dialog to choose which dataset to plot and statistics of cos sin. Save created plot to file. Filename same as dataset with attached info.</p><!--/introduction--><h2 id="1">Syntax</h2><pre class="language-matlab">plotSimulationCosSinStats()
</pre><h2 id="2">Description</h2><p><b>plotSimulationCosSinStats()</b> plot training or test dataset which are loacated in data/test or data/training. The function lists all datasets and the user must decide during user input dialog which dataset to plot. It loads path from config.mat and scans for file automatically.</p><h2 id="3">Examples</h2><pre class="language-matlab">plotSimulationCosSinStats()
</pre><h2 id="4">Input Argurments</h2><p><b>None</b></p><h2 id="5">Output Argurments</h2><p><b>None</b></p><h2 id="6">Requirements</h2><div><ul><li>Other m-files required: None</li><li>Subfunctions: None</li><li>MAT-files required: config.mat</li></ul></div><h2 id="7">See Also</h2><div><ul><li><a href="generateSimulationDatasets.html">generateSimulationDatasets</a></li><li><a href="sensorArraySimulation.html">sensorArraySimulation</a></li><li><a href="generateConfigMat.html">generateConfigMat</a></li></ul></div><p>Created on November 30. 2020 by Tobias Wulf. Copyright Tobias Wulf 2020.</p><p>
<!--
Hidden Clutter.
Edited on Month DD. YYYY by Editor: Single line description.
-->
</p><pre class="codeinput"><span class="keyword">function</span> plotSimulationCosSinStats()
    <span class="comment">% scan for datasets and load needed configurations %%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="keyword">try</span>
        disp(<span class="string">'Plot simulation dataset ...'</span>);
        close <span class="string">all</span>;
        <span class="comment">% load path variables</span>
        load(<span class="string">'config.mat'</span>, <span class="string">'PathVariables'</span>);
        <span class="comment">% scan for datasets</span>
        TrainingDatasets = dir(fullfile(PathVariables.trainingDataPath, <span class="keyword">...</span>
            <span class="string">'Training_*.mat'</span>));
        TestDatasets = dir(fullfile(PathVariables.testDataPath, <span class="string">'Test_*.mat'</span>));
        allDatasets = [TrainingDatasets; TestDatasets];
        <span class="comment">% check if files available</span>
        <span class="keyword">if</span> isempty(allDatasets)
            error(<span class="string">'No training or test datasets found.'</span>);
        <span class="keyword">end</span>
    <span class="keyword">catch</span> ME
        rethrow(ME)
    <span class="keyword">end</span>

    <span class="comment">% display availabe datasets to user, decide which to plot %%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

    <span class="comment">% number of datasets</span>
    nDatasets = length(allDatasets);
    fprintf(<span class="string">'Found %d datasets:\n'</span>, nDatasets)
    <span class="keyword">for</span> i = 1:nDatasets
        fprintf(<span class="string">'%s\t:\t(%d)\n'</span>, allDatasets(i).name, i)
    <span class="keyword">end</span>
    <span class="comment">% get numeric user input to indicate which dataset to plot</span>
    iDataset = input(<span class="string">'Type number to choose dataset to plot to: '</span>);

    <span class="comment">% load dataset and ask user which one and how many angles %%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="keyword">try</span>
        ds = load(fullfile(allDatasets(iDataset).folder, <span class="keyword">...</span>
            allDatasets(iDataset).name));
        <span class="comment">% check how many angles in dataset and let user decide how many to</span>
        <span class="comment">% render in polt</span>
        fprintf(<span class="string">'Detect %d angles in dataset ...\n'</span>, <span class="keyword">...</span>
            ds.Info.UseOptions.nAngles);
        nSubAngles = input(<span class="string">'How many angles to you wish to plot: '</span>);
        <span class="comment">% nSubAngles = 120;</span>
        <span class="comment">% indices for data to plot, get sample distance for even distance</span>
        sampleDistance = length(downsample(ds.Data.angles, nSubAngles));
        <span class="comment">% get subset of angles</span>
        subAngles = downsample(ds.Data.angles, sampleDistance);
        nSubAngles = length(subAngles); <span class="comment">% just ensure</span>
        <span class="comment">% get indices for subset data</span>
        indices = find(ismember(ds.Data.angles, subAngles));
    <span class="keyword">catch</span> ME
        rethrow(ME)
    <span class="keyword">end</span>

    <span class="comment">% figure save path for different formats %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    fPath = fullfile(PathVariables.saveImagesPath);

    <span class="comment">% create dataset figure for a subset or all angle %%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    fig = figure(<span class="string">'Name'</span>, <span class="string">'Sensor Array'</span>, <span class="keyword">...</span>
        <span class="string">'NumberTitle'</span> , <span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'WindowStyle'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'MenuBar'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
        <span class="string">'ToolBar'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
        <span class="string">'Units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
        <span class="string">'OuterPosition'</span>, [0 0 37 29], <span class="keyword">...</span>
        <span class="string">'PaperType'</span>, <span class="string">'a4'</span>, <span class="keyword">...</span>
        <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
        <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>, <span class="keyword">...</span>
        <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>, <span class="keyword">...</span>
        <span class="string">'DoubleBuffer'</span>, <span class="string">'on'</span>, <span class="keyword">...</span>
        <span class="string">'RendererMode'</span>, <span class="string">'manual'</span>, <span class="keyword">...</span>
        <span class="string">'Renderer'</span>, <span class="string">'painters'</span>);

    tdl = tiledlayout(fig, 2, 1, <span class="keyword">...</span>
        <span class="string">'Padding'</span>, <span class="string">'compact'</span>, <span class="keyword">...</span>
        <span class="string">'TileSpacing'</span> , <span class="string">'compact'</span>);


    title(tdl, <span class="string">'Sensor Array Simulation'</span>, <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 18, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);

    subline1 = <span class="string">"Sensor Array (%s) of $%d\\times%d$ sensors, "</span> + <span class="keyword">...</span>
        <span class="string">"an edge length of $%.1f$ mm, a rel. pos. to magnet surface of"</span>;
    subline2 = <span class="string">" $(%.1f, %.1f, -(%.1f))$ in mm, a magnet tilt"</span> + <span class="keyword">...</span>
        <span class="string">" of $%.1f^\\circ$, a sphere radius of $%.1f$ mm, a imprinted"</span>;
    subline3 = <span class="string">"field strength of $%.1f$ kA/m at $%.1f$ mm from"</span> + <span class="keyword">...</span>
        <span class="string">" sphere surface in z-axis, $%d$ rotation angles with a "</span>;
    subline4 = <span class="string">"step width of $%.1f^\\circ$ and a resolution of"</span> + <span class="keyword">...</span>
        <span class="string">" $%.1f^\\circ$. Visualized is a subset of $%d$ angles in "</span>;
    subline5 = <span class="string">"sample distance of $%d$ angles. Based on %s"</span> + <span class="keyword">...</span>
        <span class="string">" characterization reference %s."</span>;
    sub = [sprintf(subline1, <span class="keyword">...</span>
                   ds.Info.SensorArrayOptions.geometry, <span class="keyword">...</span>
                   ds.Info.SensorArrayOptions.dimension, <span class="keyword">...</span>
                   ds.Info.SensorArrayOptions.dimension, <span class="keyword">...</span>
                   ds.Info.SensorArrayOptions.edge); <span class="keyword">...</span>
           sprintf(subline2, <span class="keyword">...</span>
                   ds.Info.UseOptions.xPos, <span class="keyword">...</span>
                   ds.Info.UseOptions.yPos, <span class="keyword">...</span>
                   ds.Info.UseOptions.zPos, <span class="keyword">...</span>
                   ds.Info.UseOptions.tilt, <span class="keyword">...</span>
                   ds.Info.DipoleOptions.sphereRadius); <span class="keyword">...</span>
           sprintf(subline3, <span class="keyword">...</span>
                   ds.Info.DipoleOptions.H0mag, <span class="keyword">...</span>
                   ds.Info.DipoleOptions.z0, <span class="keyword">...</span>
                   ds.Info.UseOptions.nAngles); <span class="keyword">...</span>
           sprintf(subline4, <span class="keyword">...</span>
                   ds.Data.angleStep, <span class="keyword">...</span>
                   ds.Info.UseOptions.angleRes, <span class="keyword">...</span>
                   nSubAngles)
           sprintf(subline5, <span class="keyword">...</span>
                   sampleDistance, <span class="keyword">...</span>
                   ds.Info.CharData, <span class="keyword">...</span>
                   ds.Info.UseOptions.BridgeReference)];

    subtitle(tdl, sub, <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 14, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);

    <span class="comment">% get subset of needed data to plot, only one load %%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    M = ds.Info.SensorArrayOptions.dimension^2;
    <span class="comment">% N = ds.Info.UseOptions.nAngles;</span>
    res = ds.Info.UseOptions.angleRes;
    <span class="comment">%angles = ds.Data.angles;</span>
    anglesIP = 0:res:360-res;

    <span class="comment">% load V subset and reshape for easier computing statistics</span>
    Vcos = squeeze(reshape(ds.Data.Vcos(:,:,indices), 1, M, nSubAngles));
    Vsin = squeeze(reshape(ds.Data.Vsin(:,:,indices), 1, M, nSubAngles));

    <span class="comment">% load offset voltage to subtract from cosinus, sinus voltage</span>
    Voff = ds.Info.SensorArrayOptions.Voff;
    Vcc = ds.Info.SensorArrayOptions.Vcc;

    <span class="comment">% compute statistics of Vcos Vsin %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">% interpolate with makima makes best results, ensure to kill nans for</span>
    <span class="comment">% fill otherwise fill strokes, use linstyle none for fill without frame</span>
    interpM = <span class="string">'makima'</span>;
    VcosMean = mean(Vcos, 1);
    VcosMeanIP = interp1(subAngles, VcosMean, anglesIP, interpM);

    VcosStd = std(Vcos, 1, 1);
    VcosVar = var(Vcos, 1, 1); <span class="comment">% std^2</span>

    <span class="comment">% meanvariation coefficient in percent</span>
    VcosMVCP = mean(VcosStd ./ VcosMean) * 100;

    VcosUpper1 = VcosMean + VcosStd;
    VcosUpper2 = VcosMean + VcosVar;
    VcosLower1 = VcosMean - VcosStd;
    VcosLower2 = VcosMean - VcosVar;

    VcosUpper1IP = interp1(subAngles, VcosUpper1, anglesIP, interpM);
    VcosUpper1IP = fillmissing(VcosUpper1IP, <span class="string">'previous'</span>);

    VcosLower1IP = interp1(subAngles, VcosLower1, anglesIP, interpM);
    VcosLower1IP = fillmissing(VcosLower1IP, <span class="string">'previous'</span>);

    VcosUpper2IP = interp1(subAngles, VcosUpper2, anglesIP, interpM);
    VcosUpper2IP = fillmissing(VcosUpper2IP, <span class="string">'previous'</span>);

    VcosLower2IP = interp1(subAngles, VcosLower2, anglesIP, interpM);
    VcosLower2IP = fillmissing(VcosLower2IP, <span class="string">'previous'</span>);

    VsinMean = mean(Vsin, 1);
    VsinMeanIP = interp1(subAngles, VsinMean, anglesIP, interpM);

    VsinStd = std(Vsin, 1, 1);
    VsinVar = var(Vsin, 1, 1); <span class="comment">% std^2</span>

    <span class="comment">% meanvariation coefficient in percent</span>
    VsinMVCP = mean(VsinStd ./ VsinMean) * 100;

    VsinUpper1 = VsinMean + VsinStd;
    VsinUpper2 = VsinMean + VsinVar;
    VsinLower1 = VsinMean - VsinStd;
    VsinLower2 = VsinMean - VsinVar;

    VsinUpper1IP = interp1(subAngles, VsinUpper1, anglesIP, interpM);
    VsinUpper1IP = fillmissing(VsinUpper1IP, <span class="string">'previous'</span>);

    VsinLower1IP = interp1(subAngles, VsinLower1, anglesIP, interpM);
    VsinLower1IP = fillmissing(VsinLower1IP, <span class="string">'previous'</span>);

    VsinUpper2IP = interp1(subAngles, VsinUpper2, anglesIP, interpM);
    VsinUpper2IP = fillmissing(VsinUpper2IP, <span class="string">'previous'</span>);

    VsinLower2IP = interp1(subAngles, VsinLower2, anglesIP, interpM);
    VsinLower2IP = fillmissing(VsinLower2IP, <span class="string">'previous'</span>);

    <span class="comment">% plot Vcos Vsin over angles %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

    <span class="comment">% Vcos</span>
    nexttile;
    hold <span class="string">on</span>;

    fillStdX = [anglesIP, fliplr(anglesIP)];
    fillStdY = [VcosLower1IP, fliplr(VcosUpper1IP)];
    fill(fillStdX, fillStdY, [0.95 0.95 0.95], <span class="string">'LineStyle'</span>, <span class="string">'none'</span>);

    fillVarX = [anglesIP, fliplr(anglesIP)];
    fillVarY = [VcosLower2IP, fliplr(VcosUpper2IP)];
    fill(fillVarX, fillVarY, [0.7 0.7 0.7], <span class="string">'LineStyle'</span>, <span class="string">'none'</span>);

    yline(Voff, <span class="string">'k--'</span>);
    scatter(subAngles, VcosUpper1, [], <span class="string">'r*'</span>);
    plot(anglesIP, VcosUpper1IP, <span class="string">'r-.'</span>);
    scatter(subAngles, VcosMean, [], <span class="string">'m*'</span>);
    plot(anglesIP, VcosMeanIP, <span class="string">'m-.'</span>);
    scatter(subAngles, VcosLower1, [], <span class="string">'b*'</span>);
    plot(anglesIP, VcosLower1IP, <span class="string">'b-.'</span>);


    hold <span class="string">off</span>;
    xlim([-res 360-res]);
    <span class="comment">%ylim(ylimits);</span>
    grid <span class="string">on</span>;

    xlabel(<span class="string">'$\theta$ in Degree'</span>, <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);

    ylabel(<span class="string">'$V{cos}(\theta)$ in V'</span>, <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);

    title(sprintf(<span class="keyword">...</span>
        <span class="string">"Compare $V_{cos}(\\theta)$ for each Array Member $V_{cc} = %.1f$"</span> + <span class="keyword">...</span>
        <span class="string">"V, $V_{off} = %.2f$ V, $\\bar{\\sigma_\\mu} = %.2f$ perc."</span>, <span class="keyword">...</span>
        Vcc, Voff, VcosMVCP), <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);

    <span class="comment">% Vsin</span>
    nexttile;
    hold <span class="string">on</span>;

    fillStdX = [anglesIP, fliplr(anglesIP)];
    fillStdY = [VsinLower1IP, fliplr(VsinUpper1IP)];
    l1 = fill(fillStdX, fillStdY, [0.95 0.95 0.95], <span class="string">'LineStyle'</span>, <span class="string">'none'</span>);

    fillVarX = [anglesIP, fliplr(anglesIP)];
    fillVarY = [VsinLower2IP, fliplr(VsinUpper2IP)];
    l2 = fill(fillVarX, fillVarY, [0.7 0.7 0.7], <span class="string">'LineStyle'</span>, <span class="string">'none'</span>);

    l3 = yline(Voff, <span class="string">'k--'</span>);
    l4 = scatter(subAngles, VsinUpper1, [], <span class="string">'r*'</span>);
    l5 = plot(anglesIP, VsinUpper1IP, <span class="string">'r-.'</span>);
    l6 = scatter(subAngles, VsinMean, [], <span class="string">'m*'</span>);
    l7 = plot(anglesIP, VsinMeanIP, <span class="string">'m-.'</span>);
    l8 = scatter(subAngles, VsinLower1, [], <span class="string">'b*'</span>);
    l9 = plot(anglesIP, VsinLower1IP, <span class="string">'b-.'</span>);

    hold <span class="string">off</span>;
    xlim([-res 360-res]);
    grid <span class="string">on</span>;

    xlabel(<span class="string">'$\theta$ in Degree'</span>, <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);

    ylabel(<span class="string">'$V{sin}(\theta)$ in V'</span>, <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    title(sprintf(<span class="keyword">...</span>
        <span class="string">"Compare $V_{sin}(\\theta)$ for each Array Member $V_{cc} = %.1f$"</span> + <span class="keyword">...</span>
        <span class="string">" V, $V_{off} = %.2f$ V, $\\bar{\\sigma_\\mu} = %.2f$ perc."</span>, <span class="keyword">...</span>
        Vcc, Voff, VsinMVCP), <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);

    <span class="comment">% plot legend %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    l = [l1 l2 l3 l4 l5 l6 l7 l8 l9];
    L = legend(l, {<span class="string">'$2\sigma$'</span>, <span class="keyword">...</span>
                   <span class="string">'$2\sigma^2$'</span>, <span class="keyword">...</span>
                   <span class="string">'$V_{off}$'</span>, <span class="keyword">...</span>
                   <span class="string">'$U_{lim} = \mu + \sigma$'</span>, <span class="keyword">...</span>
                   sprintf(<span class="string">'$%s(U_{lim})$'</span>, interpM), <span class="keyword">...</span>
                   <span class="string">'$\mu(V)$'</span>, <span class="keyword">...</span>
                   sprintf(<span class="string">'$%s(\\mu)$'</span>, interpM), <span class="keyword">...</span>
                   <span class="string">'$L_{lim} = \mu - \sigma$'</span>, <span class="keyword">...</span>
                   sprintf(<span class="string">'$%s(L_{lim})$'</span>, interpM)}, <span class="keyword">...</span>
        <span class="string">'FontWeight'</span>, <span class="string">'normal'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="keyword">...</span>
        <span class="string">'FontName'</span>, <span class="string">'Times'</span>, <span class="keyword">...</span>
        <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    L.Layout.Tile = <span class="string">'east'</span>;

    <span class="comment">% save figure to file %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
    <span class="comment">% get file path to save figure with angle index</span>
    [~, fName, ~] = fileparts(ds.Info.filePath);

    <span class="comment">% save to various formats</span>
    yesno = input(<span class="string">'Save? [y/n]: '</span>, <span class="string">'s'</span>);
    <span class="keyword">if</span> strcmp(yesno, <span class="string">'y'</span>)
        fLabel = input(<span class="string">'Enter file label: '</span>, <span class="string">'s'</span>);
        fName =  fName + <span class="string">"_StatsPlot_"</span> + fLabel;
        savefig(fig, fullfile(fPath, fName));
        print(fig, fullfile(fPath, fName), <span class="string">'-dsvg'</span>);
        print(fig, fullfile(fPath, fName), <span class="string">'-depsc'</span>, <span class="string">'-tiff'</span>, <span class="string">'-loose'</span>);
        print(fig, fullfile(fPath, fName), <span class="string">'-dpdf'</span>, <span class="string">'-loose'</span>, <span class="string">'-fillpage'</span>);
    <span class="keyword">end</span>
    close(fig);
<span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% plotSimulationCosSinStats
% Search for available trainings or test dataset and plot dataset. Follow user
% input dialog to choose which dataset to plot and statistics of cos sin.
% Save created plot to file. Filename same as dataset with attached info.
%
%% Syntax
%   plotSimulationCosSinStats()
%
%
%% Description
% *plotSimulationCosSinStats()* plot training or test dataset which are
% loacated in data/test or data/training. The function lists all datasets and
% the user must decide during user input dialog which dataset to plot.
% It loads path from config.mat and scans for file automatically.
%
%
%% Examples
%   plotSimulationCosSinStats()
%
%
%% Input Argurments
% *None*
%
%
%% Output Argurments
% *None*
%
%
%% Requirements
% * Other m-files required: None
% * Subfunctions: None
% * MAT-files required: config.mat
%
%
%% See Also
% * <generateSimulationDatasets.html generateSimulationDatasets>
% * <sensorArraySimulation.html sensorArraySimulation>
% * <generateConfigMat.html generateConfigMat>
%
%
% Created on November 30. 2020 by Tobias Wulf. Copyright Tobias Wulf 2020.
%
% <html>
% <!REPLACE_WITH_DASH_DASH
% Hidden Clutter.
% Edited on Month DD. YYYY by Editor: Single line description.
% REPLACE_WITH_DASH_DASH>
% </html>
%
function plotSimulationCosSinStats()
    % scan for datasets and load needed configurations %%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    try
        disp('Plot simulation dataset ...');
        close all;
        % load path variables
        load('config.mat', 'PathVariables');
        % scan for datasets
        TrainingDatasets = dir(fullfile(PathVariables.trainingDataPath, ...
            'Training_*.mat'));
        TestDatasets = dir(fullfile(PathVariables.testDataPath, 'Test_*.mat'));
        allDatasets = [TrainingDatasets; TestDatasets];
        % check if files available
        if isempty(allDatasets)
            error('No training or test datasets found.');
        end
    catch ME
        rethrow(ME)
    end
    
    % display availabe datasets to user, decide which to plot %%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    % number of datasets
    nDatasets = length(allDatasets);
    fprintf('Found %d datasets:\n', nDatasets)
    for i = 1:nDatasets
        fprintf('%s\t:\t(%d)\n', allDatasets(i).name, i)
    end
    % get numeric user input to indicate which dataset to plot
    iDataset = input('Type number to choose dataset to plot to: ');
        
    % load dataset and ask user which one and how many angles %%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    try
        ds = load(fullfile(allDatasets(iDataset).folder, ...
            allDatasets(iDataset).name));
        % check how many angles in dataset and let user decide how many to
        % render in polt
        fprintf('Detect %d angles in dataset ...\n', ...
            ds.Info.UseOptions.nAngles);
        nSubAngles = input('How many angles to you wish to plot: ');
        % nSubAngles = 120;
        % indices for data to plot, get sample distance for even distance
        sampleDistance = length(downsample(ds.Data.angles, nSubAngles));
        % get subset of angles
        subAngles = downsample(ds.Data.angles, sampleDistance);
        nSubAngles = length(subAngles); % just ensure
        % get indices for subset data
        indices = find(ismember(ds.Data.angles, subAngles));
    catch ME
        rethrow(ME)
    end
    
    % figure save path for different formats %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    fPath = fullfile(PathVariables.saveImagesPath);
    
    % create dataset figure for a subset or all angle %%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    fig = figure('Name', 'Sensor Array', ...
        'NumberTitle' , 'off', ...
        'WindowStyle', 'normal', ...
        'MenuBar', 'none', ...
        'ToolBar', 'none', ...
        'Units', 'centimeters', ...
        'OuterPosition', [0 0 37 29], ...
        'PaperType', 'a4', ...
        'PaperUnits', 'centimeters', ...
        'PaperOrientation', 'landscape', ...
        'PaperPositionMode', 'auto', ...
        'DoubleBuffer', 'on', ...
        'RendererMode', 'manual', ...
        'Renderer', 'painters');
    
    tdl = tiledlayout(fig, 2, 1, ...
        'Padding', 'compact', ...
        'TileSpacing' , 'compact');
    
    
    title(tdl, 'Sensor Array Simulation', ...
        'FontWeight', 'normal', ...
        'FontSize', 18, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    
    subline1 = "Sensor Array (%s) of $%d\\times%d$ sensors, " + ...
        "an edge length of $%.1f$ mm, a rel. pos. to magnet surface of";
    subline2 = " $(%.1f, %.1f, -(%.1f))$ in mm, a magnet tilt" + ...
        " of $%.1f^\\circ$, a sphere radius of $%.1f$ mm, a imprinted";
    subline3 = "field strength of $%.1f$ kA/m at $%.1f$ mm from" + ...
        " sphere surface in z-axis, $%d$ rotation angles with a ";
    subline4 = "step width of $%.1f^\\circ$ and a resolution of" + ...
        " $%.1f^\\circ$. Visualized is a subset of $%d$ angles in ";
    subline5 = "sample distance of $%d$ angles. Based on %s" + ...
        " characterization reference %s.";
    sub = [sprintf(subline1, ...
                   ds.Info.SensorArrayOptions.geometry, ...
                   ds.Info.SensorArrayOptions.dimension, ...
                   ds.Info.SensorArrayOptions.dimension, ...
                   ds.Info.SensorArrayOptions.edge); ...
           sprintf(subline2, ...
                   ds.Info.UseOptions.xPos, ...
                   ds.Info.UseOptions.yPos, ...
                   ds.Info.UseOptions.zPos, ...
                   ds.Info.UseOptions.tilt, ...
                   ds.Info.DipoleOptions.sphereRadius); ...
           sprintf(subline3, ...
                   ds.Info.DipoleOptions.H0mag, ...
                   ds.Info.DipoleOptions.z0, ...
                   ds.Info.UseOptions.nAngles); ...
           sprintf(subline4, ...
                   ds.Data.angleStep, ...
                   ds.Info.UseOptions.angleRes, ...
                   nSubAngles)
           sprintf(subline5, ...
                   sampleDistance, ...
                   ds.Info.CharData, ...
                   ds.Info.UseOptions.BridgeReference)];
    
    subtitle(tdl, sub, ...
        'FontWeight', 'normal', ...
        'FontSize', 14, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    
    % get subset of needed data to plot, only one load %%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    M = ds.Info.SensorArrayOptions.dimension^2;
    % N = ds.Info.UseOptions.nAngles;
    res = ds.Info.UseOptions.angleRes;
    %angles = ds.Data.angles;
    anglesIP = 0:res:360-res;
    
    % load V subset and reshape for easier computing statistics
    Vcos = squeeze(reshape(ds.Data.Vcos(:,:,indices), 1, M, nSubAngles));
    Vsin = squeeze(reshape(ds.Data.Vsin(:,:,indices), 1, M, nSubAngles));
    
    % load offset voltage to subtract from cosinus, sinus voltage
    Voff = ds.Info.SensorArrayOptions.Voff;
    Vcc = ds.Info.SensorArrayOptions.Vcc;
    
    % compute statistics of Vcos Vsin %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % interpolate with makima makes best results, ensure to kill nans for
    % fill otherwise fill strokes, use linstyle none for fill without frame
    interpM = 'makima';
    VcosMean = mean(Vcos, 1);
    VcosMeanIP = interp1(subAngles, VcosMean, anglesIP, interpM);
     
    VcosStd = std(Vcos, 1, 1); 
    VcosVar = var(Vcos, 1, 1); % std^2
    
    % meanvariation coefficient in percent
    VcosMVCP = mean(VcosStd ./ VcosMean) * 100;
    
    VcosUpper1 = VcosMean + VcosStd;
    VcosUpper2 = VcosMean + VcosVar;
    VcosLower1 = VcosMean - VcosStd;
    VcosLower2 = VcosMean - VcosVar;
    
    VcosUpper1IP = interp1(subAngles, VcosUpper1, anglesIP, interpM);
    VcosUpper1IP = fillmissing(VcosUpper1IP, 'previous');
    
    VcosLower1IP = interp1(subAngles, VcosLower1, anglesIP, interpM);
    VcosLower1IP = fillmissing(VcosLower1IP, 'previous');
    
    VcosUpper2IP = interp1(subAngles, VcosUpper2, anglesIP, interpM);
    VcosUpper2IP = fillmissing(VcosUpper2IP, 'previous');
    
    VcosLower2IP = interp1(subAngles, VcosLower2, anglesIP, interpM);
    VcosLower2IP = fillmissing(VcosLower2IP, 'previous');
    
    VsinMean = mean(Vsin, 1);
    VsinMeanIP = interp1(subAngles, VsinMean, anglesIP, interpM);
     
    VsinStd = std(Vsin, 1, 1); 
    VsinVar = var(Vsin, 1, 1); % std^2
    
    % meanvariation coefficient in percent
    VsinMVCP = mean(VsinStd ./ VsinMean) * 100;
    
    VsinUpper1 = VsinMean + VsinStd;
    VsinUpper2 = VsinMean + VsinVar;
    VsinLower1 = VsinMean - VsinStd;
    VsinLower2 = VsinMean - VsinVar;
    
    VsinUpper1IP = interp1(subAngles, VsinUpper1, anglesIP, interpM);
    VsinUpper1IP = fillmissing(VsinUpper1IP, 'previous');
    
    VsinLower1IP = interp1(subAngles, VsinLower1, anglesIP, interpM);
    VsinLower1IP = fillmissing(VsinLower1IP, 'previous');
    
    VsinUpper2IP = interp1(subAngles, VsinUpper2, anglesIP, interpM);
    VsinUpper2IP = fillmissing(VsinUpper2IP, 'previous');
    
    VsinLower2IP = interp1(subAngles, VsinLower2, anglesIP, interpM);
    VsinLower2IP = fillmissing(VsinLower2IP, 'previous');
    
    % plot Vcos Vsin over angles %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
       
    % Vcos
    nexttile;
    hold on;
    
    fillStdX = [anglesIP, fliplr(anglesIP)];
    fillStdY = [VcosLower1IP, fliplr(VcosUpper1IP)];
    fill(fillStdX, fillStdY, [0.95 0.95 0.95], 'LineStyle', 'none');
    
    fillVarX = [anglesIP, fliplr(anglesIP)];
    fillVarY = [VcosLower2IP, fliplr(VcosUpper2IP)];
    fill(fillVarX, fillVarY, [0.7 0.7 0.7], 'LineStyle', 'none');
    
    yline(Voff, 'kREPLACE_WITH_DASH_DASH');
    scatter(subAngles, VcosUpper1, [], 'r*');
    plot(anglesIP, VcosUpper1IP, 'r-.');
    scatter(subAngles, VcosMean, [], 'm*');
    plot(anglesIP, VcosMeanIP, 'm-.');
    scatter(subAngles, VcosLower1, [], 'b*');
    plot(anglesIP, VcosLower1IP, 'b-.');
    
    
    hold off;
    xlim([-res 360-res]);
    %ylim(ylimits);
    grid on;
    
    xlabel('$\theta$ in Degree', ...
        'FontWeight', 'normal', ...
        'FontSize', 12, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    
    ylabel('$V{cos}(\theta)$ in V', ...
        'FontWeight', 'normal', ...
        'FontSize', 12, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    
    title(sprintf(...
        "Compare $V_{cos}(\\theta)$ for each Array Member $V_{cc} = %.1f$" + ...
        "V, $V_{off} = %.2f$ V, $\\bar{\\sigma_\\mu} = %.2f$ perc.", ...
        Vcc, Voff, VcosMVCP), ...
        'FontWeight', 'normal', ...
        'FontSize', 12, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    
    % Vsin
    nexttile;
    hold on;
    
    fillStdX = [anglesIP, fliplr(anglesIP)];
    fillStdY = [VsinLower1IP, fliplr(VsinUpper1IP)];
    l1 = fill(fillStdX, fillStdY, [0.95 0.95 0.95], 'LineStyle', 'none');
    
    fillVarX = [anglesIP, fliplr(anglesIP)];
    fillVarY = [VsinLower2IP, fliplr(VsinUpper2IP)];
    l2 = fill(fillVarX, fillVarY, [0.7 0.7 0.7], 'LineStyle', 'none');
    
    l3 = yline(Voff, 'kREPLACE_WITH_DASH_DASH');
    l4 = scatter(subAngles, VsinUpper1, [], 'r*');
    l5 = plot(anglesIP, VsinUpper1IP, 'r-.');
    l6 = scatter(subAngles, VsinMean, [], 'm*');
    l7 = plot(anglesIP, VsinMeanIP, 'm-.');
    l8 = scatter(subAngles, VsinLower1, [], 'b*');
    l9 = plot(anglesIP, VsinLower1IP, 'b-.');

    hold off;
    xlim([-res 360-res]);
    grid on;
    
    xlabel('$\theta$ in Degree', ...
        'FontWeight', 'normal', ...
        'FontSize', 12, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    
    ylabel('$V{sin}(\theta)$ in V', ...
        'FontWeight', 'normal', ...
        'FontSize', 12, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    title(sprintf(...
        "Compare $V_{sin}(\\theta)$ for each Array Member $V_{cc} = %.1f$" + ...
        " V, $V_{off} = %.2f$ V, $\\bar{\\sigma_\\mu} = %.2f$ perc.", ...
        Vcc, Voff, VsinMVCP), ...
        'FontWeight', 'normal', ...
        'FontSize', 12, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    
    % plot legend %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    l = [l1 l2 l3 l4 l5 l6 l7 l8 l9];
    L = legend(l, {'$2\sigma$', ...
                   '$2\sigma^2$', ...
                   '$V_{off}$', ...
                   '$U_{lim} = \mu + \sigma$', ...
                   sprintf('$%s(U_{lim})$', interpM), ...
                   '$\mu(V)$', ...
                   sprintf('$%s(\\mu)$', interpM), ...
                   '$L_{lim} = \mu - \sigma$', ...
                   sprintf('$%s(L_{lim})$', interpM)}, ...
        'FontWeight', 'normal', ...
        'FontSize', 12, ...
        'FontName', 'Times', ...
        'Interpreter', 'latex');
    L.Layout.Tile = 'east';
            
    % save figure to file %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % get file path to save figure with angle index
    [~, fName, ~] = fileparts(ds.Info.filePath);
    
    % save to various formats
    yesno = input('Save? [y/n]: ', 's');
    if strcmp(yesno, 'y')
        fLabel = input('Enter file label: ', 's');
        fName =  fName + "_StatsPlot_" + fLabel;
        savefig(fig, fullfile(fPath, fName));
        print(fig, fullfile(fPath, fName), '-dsvg');
        print(fig, fullfile(fPath, fName), '-depsc', '-tiff', '-loose');
        print(fig, fullfile(fPath, fName), '-dpdf', '-loose', '-fillpage');
    end
    close(fig);
end


##### SOURCE END #####
--></body></html>

% This LaTeX was auto-generated from MATLAB code.
% To make changes, update the MATLAB code and republish this document.

\documentclass{standalone}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{textcomp}
\usepackage[framed, numbered]{matlab-prettifier}

\sloppy
\definecolor{lightgray}{gray}{0.5}
\setlength{\parindent}{0pt}

\begin{document}

    
    \begin{par}
Plot NXP KMZ60 characterization field transfer curves.
\end{par} \vspace{1em}


{\footnotesize\textbf{Syntax}}

\begin{lstlisting}[style=Matlab-editor, basicstyle=\ttfamily\scriptsize]
plotKMZ60TransferCurves()
\end{lstlisting}


{\footnotesize\textbf{Description}}

\begin{par}
\textbf{plotKMZ60TransferCurves()} plot characterization field of KMZ 60 sensor.
\end{par} \vspace{1em}


{\footnotesize\textbf{Examples}}

\begin{lstlisting}[style=Matlab-editor, basicstyle=\ttfamily\scriptsize]
plotKMZ60TransferCurves();
\end{lstlisting}


{\footnotesize\textbf{Input Arguments}}

\begin{par}
\textbf{None}
\end{par} \vspace{1em}


{\footnotesize\textbf{Output Arguments}}

\begin{par}
\textbf{None}
\end{par} \vspace{1em}


{\footnotesize\textbf{Requirements}}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item Other m-files: none
   \item Subfunctions: none
   \item MAT-files required: data/NXP\_KMZ60\_Characterization\_2020-12-03\_16-53-16-721.mat,   data/config.mat
\end{itemize}


{\footnotesize\textbf{See Also}}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \begin{verbatim}plotKMZ60CharField\end{verbatim}
\end{itemize}
\begin{par}
Created on December 05. 2020 by Tobias Wulf. Copyright Tobias Wulf 2020.
\end{par} \vspace{1em}
\begin{par}

\end{par} \vspace{1em}
\begin{lstlisting}[style=Matlab-editor, basicstyle=\ttfamily\scriptsize]
function plotKMZ60TransferCurves()
    try
        % load dataset path and dataset content into function workspace
        load('config.mat', 'PathVariables');
        load(PathVariables.kmz60DatasetPath, 'Data', 'Info');
%         close all;
    catch ME
        rethrow(ME)
    end

    % load needed data from dataset in to local variables for better handling %%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % get from user which field to investigate and limits for plateau
    fields = Info.SensorOutput.CosinusBridge.Determination;
    nFields = length(fields);
    fprintf('Choose 1 of %d fields ...\n', nFields);
    for i = 1:nFields
        fprintf('%s\t:\t(%d)\n', fields{i}, i);
    end

    iField = 1; % input('Choice: ');
    field = fields{iField};
    pl = 20; % input('Plateu limit in kA/m: ');

    Vcos = Data.SensorOutput.CosinusBridge.(field);
    Vsin = Data.SensorOutput.SinusBridge.(field);
    gain = Info.SensorOutput.BridgeGain;
    HxScale = Data.MagneticField.hx;
    HyScale = Data.MagneticField.hy;
    Hmin = Info.MagneticField.MinAmplitude;
    Hmax = Info.MagneticField.MaxAmplitude;

    % get unit strings from
    kApm = Info.Units.MagneticFieldStrength;
    mV = Info.Units.SensorOutputVoltage;

    % get dataset infos and format strings to place in figures
    % subtitle string for all figures
    infoStr = join([Info.SensorManufacturer, ...
        Info.Sensor, Info.SensorTechnology, ...
        Info.SensorType, "Sensor Characterization Dataset."]);
    dateStr = join(["Created on", Info.Created, "by", 'Thorben Sch\"uthe', ...
        "and updated on", Info.Edited, "by", Info.Editor + "."]);

    % clear dataset all loaded
    clear Data Info;

    % figure save path for different formats %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    fName = sprintf("kmz60_transfer_curves_%s", field);
    fPath = fullfile(PathVariables.saveImagesPath, fName);

    % define slices and limits to plot %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    Hslice = 128; % hit ca. 0 kA/m
    Hlims = [-pl pl];
    mVpVlims = [-8 8];

    % create figure for plots %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    fig = figure('Name', 'Transfer Curves', 'OuterPosition', [0 0 33 30]);

    tiledlayout(fig, 2, 2);

    disp('Info:');
    disp([infoStr; dateStr]);
    disp('Title:');
    fprintf('KMZ 60 Transfer Curves: %s\n', field);
    disp(["a) Cosine Bridge Characteristic"; ...
          "b) Sine Bridge Characteristic"; ...
          "c) Transfer Curves for const. H_x = H_y = 0"]);

    % set colormap
    colormap('jet');

    % cosinus bridge %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    nexttile(1);
    im = imagesc(HxScale, HyScale, Vcos);
    set(gca, 'YDir', 'normal');
    set(im, 'AlphaData', ~isnan(Vcos));
    xticks(-20:10:20);
    yticks(-20:10:20);
    axis square xy;

    % plot lines for slice to investigate
    hold on;
    yline(HyScale(Hslice), 'k:', 'LineWidth', 3.5);
    plot(pl*cosd(0:360), pl*sind(0:360), 'k-.', 'LineWidth', 3.5);
    hold off;

    xlabel(sprintf('$H_x$ in %s', kApm));
    ylabel(sprintf('$H_y$ in %s', kApm));
    title(sprintf('a) $V_{cos}(H_x,H_y)$, Gain $ = %.1f$', gain));

    % sinus bridge %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    nexttile(2);
    im = imagesc(HxScale, HyScale, Vsin);
    set(gca, 'YDir', 'normal');
    set(im, 'AlphaData', ~isnan(Vsin));
    xticks(-20:10:20);
    yticks(-20:10:20);
    axis square xy;

    % plot lines for slice to investigate
    hold on;
    xline(HxScale(Hslice), 'k:', 'LineWidth', 3.5);
    plot(pl*cosd(0:360), pl*sind(0:360), 'k-.', 'LineWidth', 3.5);
    hold off;

    xlabel(sprintf('$H_x$ in %s', kApm));
    ylabel(sprintf('$H_y$ in %s', kApm));
    title(sprintf('b) $V_{sin}(H_x,H_y)$, Gain $ = %.1f$', gain));

    % colorbar for both %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    cb = colorbar;
    cb.Label.String = sprintf('$V_{out}$ in %s', mV);
    cb.TickLabelInterpreter = 'latex';
    cb.Label.Interpreter = 'latex';
    cb.Label.FontSize = 20;

    % cosinus bridge sclices %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    nexttile([1 2]);
    % slices
    p = plot(HxScale, Vcos(Hslice,:), HyScale, Vsin(:, Hslice)');

    % plateau limits
    if pl > 0
        hold on;
        xline(Hlims(1), 'k-.', 'LineWidth', 3.5);
        xline(Hlims(2), 'k-.', 'LineWidth', 3.5);
        hold off;
    end

    legend(p, {sprintf('$V_{cos}(H_x,H_y)$, $H_y \\approx 0$ %s', kApm), ...
               sprintf('$V_{sin}(H_x,H_y)$, $H_x \\approx 0$ %s', kApm)},...
            'Location', 'SouthEast');
    ylabel(sprintf('$V_{out}$ in %s', mV));
    xlabel(sprintf('$H$ in %s', kApm));
    title('c) Cosine and Sine Transfer Curves');
    ylim(mVpVlims);
    xlim([Hmin Hmax])

    % save results of figure %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     yesno = input('Save? [y/n]: ', 's');
%     if strcmp(yesno, 'y')
%         savefig(fig, fPath);
%         print(fig, fPath, '-dsvg');
%         print(fig, fPath, '-depsc', '-tiff', '-loose');
%         print(fig, fPath, '-dpdf', '-loose', '-fillpage');
%     end
%     close(fig)
%
end
\end{lstlisting}



\end{document}



% This LaTeX was auto-generated from MATLAB code.
% To make changes, update the MATLAB code and republish this document.

\documentclass{standalone}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{textcomp}
\usepackage[framed, numbered]{matlab-prettifier}

\sloppy
\definecolor{lightgray}{gray}{0.5}
\setlength{\parindent}{0pt}

\begin{document}

    
    \begin{par}
NXP KMZ60 characterization as second base of the sensor array simulation was although done before and was manually modified to same structure as TDK dataset. With additional values for bridge gain TDK dataset is adjusted in the same way now. The raw dataset was acquired according to the method Thorben Schüthe described in his IEEE paper for two-dimensional characterization of TMR angular sensors. The sensor characterized for both bridges a cosine and sine bridge. The bridges have a phisically phase shift of 90° so the sensor is able to reference a superimposed magnetic field in x- and y-direction. The field was generated by a cross coil setup.
\end{par} \vspace{1em}
\begin{par}
\textbf{The resulting AMR characterization field abstracts a full rotation for cosine and sine output voltages by representing two maximum and minimun areas in the characterization fields. So circular path on the charcterization fields generates two sinoid periods related to current angle position between 0° and 180° or 180° and 360°.}
\end{par} \vspace{1em}

{\footnotesize\textbf{Contents}}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item See Also
   \item Magnetic Stimulus
   \item Cosinuns Bridge Output
   \item Sine Bridge Output
   \item Operating Point
   \item Dataset Structure
\end{itemize}


{\footnotesize\textbf{See Also}}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \begin{verbatim}IEEE Document 8706125\end{verbatim}
\end{itemize}


{\footnotesize\textbf{Magnetic Stimulus}}

\begin{par}
The right stimulus is the keynote for characterization records. It needs to have the ability record slow enough for quasi static recordings but is not allowed to be real static so the magnetic field is not interrupted during the recording. Therefore slow sinoid carrier functions with even slower amplitude modulation is choosen to provide a quasi static stimulus.
\end{par} \vspace{1em}
\begin{par}
The carrier function for the Hx-field stimulus is related to the cosine bridge and so:
\end{par} \vspace{1em}
\begin{par}
$$c_1(t) = cos(\phi(t))$$
\end{par} \vspace{1em}
\begin{par}
Due to the physically phase shift the Hy-field stimulus is related to sine:
\end{par} \vspace{1em}
\begin{par}
$$c_2(t) = sin(\phi(t))$$
\end{par} \vspace{1em}
\begin{par}
Both carrier runs with same carrier frequency:
\end{par} \vspace{1em}
\begin{par}
$$f_c = 3.2 Hz$$
\end{par} \vspace{1em}
\begin{par}
so they are executed with the phase vector over time:
\end{par} \vspace{1em}
\begin{par}
$$\phi(t) = 2\pi f_c t$$
\end{par} \vspace{1em}
\begin{par}
The carrier functions are triangle modulated to generate rising and falling amplituded. The modulation frequency is  set to:
\end{par} \vspace{1em}
\begin{par}
$$f_m = 0.01Hz$$
\end{par} \vspace{1em}
\begin{par}
Which generates a stimulus with 320 periods where 160 periods feeds a rising and falling record each multiplied with maximum fieldstrength amplitude:
\end{par} \vspace{1em}
\begin{par}
$$m(t) = H_{max} \cdot tri(t) = H_{max} \cdot tri(2(t-t_0)f_m)$$
\end{par} \vspace{1em}
\begin{par}
$$t_0 = \frac{1}{2f_m}$$
\end{par} \vspace{1em}
\begin{par}
So the Hx- and Hy-field stimulus is described by:
\end{par} \vspace{1em}
\begin{par}
$$H_x(t) = m(t) \cdot c_1(t)$$
\end{par} \vspace{1em}
\begin{par}
$$H_y(t) = m(t) \cdot c_1(t)$$
\end{par} \vspace{1em}
\begin{par}
The stimulus amplitude depending on the phase in polar coordinates can be displayed for both parts by:
\end{par} \vspace{1em}
\begin{par}
$$H_{x,y}(\phi) = |H_{x,y}(\phi)| \cdot e^{j\phi} = m(t) \cdot e^{j\phi(t)}$$
\end{par} \vspace{1em}
\begin{par}
Where a rising spiral runs from center outwards for:
\end{par} \vspace{1em}
\begin{par}
$$0 < t < t_0$$
\end{par} \vspace{1em}
\begin{par}
And a falling spiral of amplitudes from outwards to center for:
\end{par} \vspace{1em}
\begin{par}
$$t_0 < t < \frac{1}{f_m}$$
\end{par} \vspace{1em}


{\footnotesize\textbf{Cosinuns Bridge Output}}

\begin{par}
The record characterization raw data are one dimensional time discrete vecotrs. To fieldstrength images like down below the recorded data must be referenced backwords to driven stimulus of Hx- and Hy-direction. But at first the image size of must be determined. Here fix size is set to 256 pixel for each direction. So it spans a vector for Hx- and Hy-direction from minimum -25 kA/m to maximum 25 kA/m in 256 steps with a resolution of 0.1961 kA/m. So it results into a 256x256 image. Now it runs for each point on the Hx- and Hy-axes and get the record index of the stimulus as backreference to the recorded bridge signal and sets the pixel. That runs for the rising modulation amplitude and falling amplitude until every pixel is hit and ended up into a dimensional function image as:
\end{par} \vspace{1em}
\begin{par}
$$V_{cos}(H_x, H_y) = [mV/V]$$
\end{par} \vspace{1em}
\begin{par}
The information of the image is build up in row. Reference Hx for constant Hy in each row. The method is also comparable to a histogram of Hx matches in the recorded sensor signal for one constant Hy and so on next histogram append on the next row for the next Hy.
\end{par} \vspace{1em}


{\footnotesize\textbf{Sine Bridge Output}}

\begin{par}
The sine characterization field is built up similar to the cosine images but the information lays now in the columns so the data is collected in each column for a constant Hx and variable Hy:
\end{par} \vspace{1em}
\begin{par}
$$V_{sin}(H_x, H_y) = [mV/V]$$
\end{par} \vspace{1em}


{\footnotesize\textbf{Operating Point}}

\begin{par}
To determine an operating point in sensor array simulation the characterization fields needs some further investigations in static Hy and variable Hx field strength for cosine bridge and vice versa for sine bridge references. In compare to the TDK TMR the NXP AMR sensor has clear linear plateau. It has a continuous non-linear areas divided in two maximum and minum areas. The best results for bridge outputs is supported by an operating point in saturation of the characterization fields so circular path on the fields should be described at 20 kA/m to 25 kA/m path radius.
\end{par} \vspace{1em}


{\footnotesize\textbf{Dataset Structure}}

\begin{par}
\textbf{Info:}
\end{par} \vspace{1em}
\begin{par}
The dataset is separated in two main structs. The first one is filled with meta data. So it represents the file header. The struct is called Info and contains information about how the dataset is acquired. So the stimulus is reconstructable from that meta data.
\end{par} \vspace{1em}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item Created - string, contains dataset creation date
   \item Creator - string, contains dataset creator
   \item Edited - string, contains last time edited date
   \item Editor - string, contains last time editor
   \item Senor - string, sensor identification name e.g. TAS2141
   \item SensorType - string, kind of sensor e.g. Angular
   \item SensorTechnology - string, bridge technology e.g. AMR, GMR, TMR
   \item SensorManufacturer - string, producer or supplier e.g. NXP, TDK
   \item \textbf{MagneticField} - struct, contains further information about Hx and Hy
   \item \textbf{SensorOutput} - struct, contains information about sensor produced   output and gathered image information
   \item \textbf{Units} - struct, contains information about used si units in dataset
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{MagneticField:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item Modulation - string, contains modulation equivalent Matlab function
   \item ModulationFrequency - double, contains frequeny of modulation in Hz
   \item CarrierFrequency - double, carrier frequency for both Hx and Hy carrier   in Hz
   \item MaxAmplitude - double, maximum Hx and Hy field amplitude in kA/m
   \item MinAmplitude - double, minimum Hx and Hy field amplitude in kA/m
   \item Steps - double, Hx- and Hy-field steps to build characterization images
   \item Resolution - double, resolution of one step in kA/m
   \item CarrierHx - string, contains Hx carrier equivalent Matlab function
   \item CarrierHy - string, contains Hy carrier equivalent Matlab function
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{SensorOutput:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{CosinusBridge} - struct, contains further information about sensor   cosine bridge outpus
   \item \textbf{SinusBridge} - struct, contains further information about sensor sine   bridge outputs
   \item BridgeGain - double, scalar factor of bridge gain for output voltage
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{CosinusBridge/ SinusBridge:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item xDimension - double, image size in x-direction
   \item yDimension - double, image size in y-direction
   \item xDirection - string, x-axis label
   \item yDirection - string, y-axis label
   \item Orientation - string, orientation of varying data, row or column
   \item Determination - cell, images in data \{"Rise", "Fall", "All", "Diff"\}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{Units:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item MagneticFieldStrength - string, kA/m
   \item Frequency - string, Hz
   \item SensorOutputVoltage - string, mV/V
\end{itemize}
\begin{par}
\textbf{Data:}
\end{par} \vspace{1em}
\begin{par}
The second struct contains the preprocessed characteriazation data of the TDK TAS2141 TMR angular Sensor. It is divided into two main structs one for the magnetic field reference points of the characterization images and one for the characteriazation sensor output images.
\end{par} \vspace{1em}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{MagneticField} - struct, contain Hx- and Hy-field vectors which are the   resolution references to each pixel in the characterization images of the   sensors preprocessed bridge outputs
   \item \textbf{SensorOutput} - struct, contains structs for cosine and sine bridge   outputs preprocessed in images of size of 256x256 pixel where each pixel   references a bridge output in mV to a certain Hx- and Hy-fieldstrength   amplitdue
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{MagneticField:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item hx - array, Hx field axis of characteriazation images column vector of 1x256   double values from -25 kA/m to 25 kA/m with a resolution of 0.1961 kA/m
   \item hy - array, Hy field axis of characteriazation images column vector of 1x256   double values from -25 kA/m to 25 kA/m with a resolution of 0.1961 kA/m
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{SensorOutput:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{CosinusBridge} - struct, contains preprocessed characterization results of   the sensors cosine bridge outputs
   \item \textbf{SinusBridge} - struct, contains preprocessed characterization results of   the sensors sine bridge outputs
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{CosinusBridge:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item Rise - array, double array of size 256x256 which references the cosine   bridge outputs for rising modulated stimulus amplitude to each cross   reference of vectors MagneticField.hx and MagneticField.hy
   \item Fall - array, double array of size 256x256 which references the cosine   bridge outputs for falling modulated stimulus amplitude to each cross   reference of vectors MagneticField.hx and MagneticField.hy
   \item All - array, double array of size 256x256 superimposed image of Rise and   Fall
   \item Diff - array, double array of size 256x256 differentiated image of Rise and   Fall
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item \textbf{SinusBridge:}
\end{itemize}
\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item Rise - array, double array of size 256x256 which references the sine   bridge outputs for rising modulated stimulus amplitude to each cross   reference of vectors MagneticField.hx and MagneticField.hy
   \item Fall - array, double array of size 256x256 which references the sine   bridge outputs for falling modulated stimulus amplitude to each cross   reference of vectors MagneticField.hx and MagneticField.hy
   \item All - array, double array of size 256x256 superimposed image of Rise and   Fall
   \item Diff - array, double array of size 256x256 differentiated image of Rise and   Fall
\end{itemize}
\begin{par}
The edited raw dataset provided from Thorben Schüthe is save with Matlabs build-in save function in a certain way to perform partial loads from the dataset.
\end{par} \vspace{1em}
\begin{lstlisting}[style=Matlab-editor, basicstyle=\ttfamily\scriptsize]
save('data/NXP_KMZ60_Characterization_2020-12-03_16-53-16-721.mat', ...
     'Info', 'Data', '-v7.3', '-nocompression')
\end{lstlisting}
\begin{par}
Created on December 05. 2020 Tobias Wulf. Copyright Tobias Wulf 2020.
\end{par} \vspace{1em}
\begin{par}

\end{par} \vspace{1em}



\end{document}

